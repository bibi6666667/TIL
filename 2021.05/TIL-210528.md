**[210528]**



## [Java] DBì— LocalDateìë£Œí˜• ì €ì¥í•˜ê³  êº¼ë‚´ê¸°

> https://kouzie.github.io/jdbc/JDBC.-2%EC%9D%BC%EC%B0%A8/#javasqlstatement-%EB%A1%9C-select%ED%95%98%EA%B8%B0

### DB í…Œì´ë¸”

ë‚ ì§œ ìë£Œí˜•ì¸ Dateë¡œ ì €ì¥í•œë‹¤

```sql
create table `booking`
(
    `id`               int         not null auto_increment,
    `room_id`          int         not null,
    `user_id`          int         not null,
    `check_in`         date not null,
    `check_out`        date not null,
    `number_of_people` int         not null,
    `total_price`      int         not null,
    primary key (`id`),
    foreign key (`room_id`) references `room` (`id`),
    foreign key (`user_id`) references `user` (`id`)
);
```

### Java ì—”í‹°í‹°

ë‚ ì§œ ìë£Œí˜•ì¸ LocalDateë¡œ ì €ì¥í•œë‹¤

```java
public class Booking {

    @Id
    private Long id;

    private Long roomId;
    private Long userId;
    private LocalDate checkIn;
    private LocalDate checkOut;
    private int numberOfPeople;
    private int totalPrice;
    
    //...
}
```

### êº¼ë‚´ê¸°

(JdbcTemplate ê¸°ì¤€)

`resultSet.getDate("ì´ë¦„").toLocalDate()`

resultSet.getDate()ì˜ ë¦¬í„´ê°’ì€ `java.util.Date`ê°€ ì•„ë‹Œ `java.sql.Date`ì´ë‹¤. ê·¸ë˜ì„œ toLocalDate()ë¥¼ ì‚¬ìš©í•´ LocalDateë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì´ í•œ ë²ˆ ë” í•„ìš”í•œ ê²ƒ.

```java
@Override
    public List<Booking> findAll() {
        String sql = "select `id`, `room_id`, `user_id`, `check_in`, `check_out`, `number_of_people`, `total_price` from booking";
        return jdbcTemplate.query(sql, bookingRowMapper());
    }

private RowMapper<Booking> bookingRowMapper() {
        return (resultSet, rowNum) -> {
            Booking booking = new Booking(resultSet.getLong("id"), resultSet.getLong("room_id"), resultSet.getLong("user_id"),
                    resultSet.getDate("check_in").toLocalDate(), resultSet.getDate("check_out").toLocalDate(), resultSet.getInt("number_of_people"),
                    resultSet.getInt("total_price"));
            return booking;
        };
    }
```

### ì €ì¥í•˜ê¸°

íŠ¹ë³„í•œ ë³€í™˜ì€ í•„ìš” ì—†ìŒ. `JdbcTemplate.update()`ë¥¼ ì‚¬ìš©í•œë‹¤.

```java
public void insert(Booking booking) {
        String sql = "insert into `booking` (`room_id`, `user_id`, `check_in`, `check_out`, `number_of_people`, `total_price`) values (?, ?, ?, ?, ?, ?)";
        jdbcTemplate.update(sql, booking.getRoomId(), booking.getUserId(), booking.getCheckIn(),
                booking.getCheckOut(), booking.getNumberOfPeople(), booking.getTotalPrice());
    }
```



## [Spring] JSON Responseë¡œ ë‚ ì§œ ìë£Œí˜• ë°›ê¸° - @DateTimeFormat

> ì¶œì²˜ğŸ™‡â€â™‚ï¸
>
> https://perfectacle.github.io/2018/01/15/jackson-local-date-time-deserialize/

ìë°”ì˜ LocalDateì™€ ê°™ì€ ë‚ ì§œ ìë£Œí˜•ì„ JSONìœ¼ë¡œ ë°›ìœ¼ë ¤ í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ TypeMisMatchExceptionì´ ë°œìƒí•œë‹¤.

```
{
	...
	"exception": "org.springframework.web.method.annotation.MethodArgumentTypeMismatchException",
	"message": Failed to convert value of type 'java.lang.String' to required type 'java.time.LocalDate';
...
}
```

ì´ëŠ” íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê¸´ ê°’ì„ Stringìœ¼ë¡œ ì¸ì‹í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

í•´ê²°ì±… : `@DateTimeFormat` ì–´ë…¸í…Œì´ì…˜ì„ ë‚ ì§œ ìë£Œí˜• íŒŒë¼ë¯¸í„°ì— ë‹¬ì•„ ì¤€ë‹¤.

```java
@RestController
public class Controller {
    @GetMapping("/")
    public DateType get(@RequestParam
                        @DateTimeFormat(pattern = "yyyy-MM-dd")
                        LocalDate date,
                        @RequestParam
                        @DateTimeFormat(pattern = "kk:mm:ss")
                        LocalTime time,
                        @RequestParam
                        @DateTimeFormat(pattern = "yyyy-MM-dd kk:mm:ss")
                        LocalDateTime dateTime) {}
}
```





## [Spring] ê°™ì€ URLì— ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì„ ë°›ì„ ìˆ˜ ìˆì„ ë•Œ ë§µí•‘í•˜ëŠ” ë²•

ê°™ì€ URLì„ ì‚¬ìš©í•˜ë©´ì„œë„, ë‹¤ë¥¸ í•œ URLì€ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ìœ¼ë¡œ ê°’ì„ ë°›ì•„ì˜¤ê³  ì‹¶ì„ ë•Œ 

`@GetMapping(params = {"checkIn", "checkOut", "minPrice", "maxPrice", "numberOfPeople"})`

ì™€ ê°™ì´ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ìœ¼ë¡œ ë°›ì•„ì˜¤ê³ ì í•˜ëŠ” ê°’ì˜ í‚¤ë¥¼ ë‚˜ì—´í•´ `@GetMapping`ì˜ `params = {...}`ì˜µì…˜ìœ¼ë¡œ ì¶”ê°€í•œë‹¤.

ì•„ë˜ì™€ ê°™ì´ ë§µí•‘í•œë‹¤.

```java
@RestController
@RequestMapping("/api/rooms")
public class RoomController {

    private RoomRepository roomRepository;
    private WishRepository wishRepository;

    public RoomController(RoomRepository roomRepository, WishRepository wishRepository) {
        this.roomRepository = roomRepository;
        this.wishRepository = wishRepository;
    }

    @GetMapping
    public Rooms showRooms() {
        List<RoomDTO> roomDTOS = roomRepository.findAll().stream()
                .map(RoomDTO::toRoomDTO)
                .collect(Collectors.toList());
        return new Rooms(roomDTOS);
    }

    @GetMapping(params = {"checkIn", "checkOut", "minPrice", "maxPrice", "numberOfPeople"})
    public Rooms searchRooms(@RequestParam("checkIn") @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate checkIn,
                             @RequestParam("checkOut") @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate checkOut,
                             @RequestParam("minPrice") int minPrice, @RequestParam("maxPrice") int maxPrice,
                             @RequestParam("numberOfPeople") int numberOfPeople) {
        List<RoomDTO> roomDTOS = roomRepository.getFilteredRooms(checkIn, checkOut, minPrice, maxPrice, numberOfPeople).stream()
                .map(RoomDTO::toRoomDTO)
                .collect(Collectors.toList());
        return new Rooms(roomDTOS);
    }
```

`http://localhost:8080/api/rooms`ìœ¼ë¡œ GETìš”ì²­ì„ ë³´ë‚´ë©´ `showRooms()`ì„ í˜¸ì¶œí•˜ê³ ,

`http://localhost:8080/api/rooms?checkIn=2021.05.05&checkOut=2021.05.06&minPrice=50000&maxPrice=60000&numberOfPeople=2`ì™€ ê°™ì´ GETìš”ì²­ì„ ë³´ë‚´ë©´ `searchRooms()`ì„ í˜¸ì¶œí•  ê²ƒì´ë‹¤.



---

## [MySQL] function does not exist ì˜¤ë¥˜ ë°œìƒ ì‹œ í•´ê²°ë²•..

> ì¶œì²˜ğŸ™‡â€â™‚ï¸
>
> https://sharehan.tistory.com/entry/MySql%EC%82%AC%EC%9A%A9-%EC%8B%9C-function-does-not-exist-%EC%98%A4%EB%A5%98%EB%B0%9C%EC%83%9D-%EC%8B%9C

`java sql SqlsyntaxErrorException FUNCTION ...` ì˜ ì›ì¸

: ì¿¼ë¦¬ë¬¸ì— ì˜¬ë°”ë¥´ì§€ ëª»í•œ ë„ì–´ì“°ê¸°ê°€ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤.

```java
String sql = "select booking.id, room_id, user_id, check_in, check_out, number_of_people, total_price" +
                " from `booking` left join `room` on room_id = room.id" +
                " where room_id = ? and " +
                " (? between check_in and check_out and ? > check_out)";
```

`.. and  (? between check_in ...)`ì˜ `and`ì™€ ê´„í˜¸ ì‚¬ì´ì— ë„ì–´ì“°ê¸°ê°€ ë‘ ë²ˆ ë˜ì–´ ìˆë‹¤.

ìœ„ ì¿¼ë¦¬ë¬¸ì²˜ëŸ¼ ì˜ëª» ì‘ì„±í•˜ë©´ `function does not exist` ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

ê·¸ë˜ë„ í•´ê²°ë˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì¶œì²˜ ë§í¬ë¥¼ ì°¸ê³ í•´ mysqlì—ì„œ `Space Ignore`ì„¤ì •ì´ ì˜ëª» ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤.



---

## [MySQL] ì¤‘ë³µë˜ëŠ” ë‚ ì§œê°€ ì—†ë„ë¡ ë‚ ì§œ ì¡°íšŒí•˜ê¸°

> ì¶œì²˜ğŸ™‡â€â™‚ï¸
>
> https://way-be-developer.tistory.com/54

ìˆ™ì†Œ ê²€ìƒ‰ ì„œë¹„ìŠ¤ì—ì„œ ê¸°ì¡´ ì˜ˆì•½ë“¤ì˜ ì²´í¬ì¸~ì²´í¬ì•„ì›ƒ ë‚ ì§œì™€ ê²¹ì¹˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸í•  ë•Œ ì‚¬ìš©í–ˆë‹¤.

### ë‚ ì§œ ì¤‘ë³µí™•ì¸ ì¿¼ë¦¬..

(ì£¼í™©ìƒ‰ = ì‚¬ìš©ì ì…ë ¥, ì´ˆë¡ìƒ‰ = ê¸°ì¡´ ì˜ˆì•½)

ì•„ë˜ 4ê°€ì§€ ì¡°ê±´ ì¤‘ ìµœì†Œ í•˜ë‚˜ë¥¼ ë§Œì¡±í•´ì•¼ í•¨

#### 1

- ì…ë ¥ ì²´í¬ì¸ between ê¸°ì¡´ ì²´í¬ì¸ and ê¸°ì¡´ ì²´í¬ì•„ì›ƒ 
- ì…ë ¥ ì²´í¬ì•„ì›ƒ > ê¸°ì¡´ ì²´í¬ì•„ì›ƒ

#### 2

- ì…ë ¥ ì²´í¬ì¸ < ê¸°ì¡´ ì²´í¬ì¸
- ì…ë ¥ ì²´í¬ì•„ì›ƒ between ê¸°ì¡´ ì²´í¬ì¸ and ê¸°ì¡´ ì²´í¬ì•„ì›ƒ 

#### 3

- ì…ë ¥ ì²´í¬ì¸ between ê¸°ì¡´ ì²´í¬ì¸ and ê¸°ì¡´ ì²´í¬ì•„ì›ƒ
- ì…ë ¥ ì²´í¬ì•„ì›ƒ between ê¸°ì¡´ ì²´í¬ì¸ and ê¸°ì¡´ ì²´í¬ì•„ì›ƒ

#### 4

- ì…ë ¥ ì²´í¬ì¸ < ê¸°ì¡´ ì²´í¬ì¸
- ì…ë ¥ ì²´í¬ì•„ì›ƒ > ê¸°ì¡´ ì²´í¬ì•„ì›ƒ

 SQLë¬¸ìœ¼ë¡œ ë³€í™˜í•˜ë©´ ì•„ë˜ì™€ ê°™ìŒ

```sql
select booking.id, room_id, user_id, check_in, check_out, number_of_people, total_price from `booking` left join `room` on room_id = room.id 
where room_id = ? 
and (? between check_in and check_out and ? > check_out) 
or (? < check_in and ? between check_in and check_out) 
or (? between check_in and check_out and ? between check_in and check_out) 
or (? < check_in and ? > check_out)";
```

