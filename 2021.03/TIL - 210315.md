**[210315]**



- ì˜¤ëŠ˜ í•œ ì¼

  - í˜¸ëˆ…ìŠ¤ ìˆ˜ì—… ë“£ê¸°
  - Heroku ë°°í¬ (ì„±ê³µ!)
  - ë¯¸ì…˜1 PR
  - ë¯¸ì…˜2 H2 ì—°ê²° ì‹œë„(2) - ì„±ê³µ!
  - ì•Œê²Œ ëœ ë‚´ìš© ì •ë¦¬.

- ë°°ìš´ ì 

  - ë‚´ ì‚½ì§ˆì´ ì§ˆë¬¸ í•œ ë²ˆìœ¼ë¡œ ì‰½ê²Œ í•´ê²°ë  ìˆ˜ ìˆë‹¤

  - ëˆ„êµ°ê°€ ë‚˜ì™€ ë˜‘ê°™ì€ ê³ ë¯¼ì„ í•˜ê³  ìˆì„ ìˆ˜ ìˆë‹¤

    â†’ ì§ˆë¬¸ì„ ë” ë§ì´ í•˜ì - ë™ë£Œì—ê²Œë“  ë§ˆìŠ¤í„°ì—ê²Œë“  ëˆ„êµ¬ì—ê²Œë“ 

  - ì–´ì œ ëª°ëë˜ ê²ƒì´ ì˜¤ëŠ˜ì€ ì´í•´ë˜ê³ , ì „ì— ì•Œì•˜ë˜ ê²ƒë„ ë‹¤ì‹œ ë°°ìš°ë‹ˆ í—·ê°ˆë¦°ë‹¤.

    â†’ ê¾¸ì¤€íˆ ì—´ì‹¬íˆ ë°°ìš°ê³  ë³µìŠµí•˜ëŠ” ìˆ˜ ë°–ì— ì—†ëŠ” ê²ƒ ê°™ë‹¤.

- ê°œì„ í•  ì 

  - ê³µë¶€ë„ ì ë‹¹íˆ ì—´ì‹¬íˆ í–ˆê³  ìˆ˜ì—…ë„ ê·¸ëŸ­ì €ëŸ­ ì—´ì‹¬íˆ ë“¤ì—ˆë‹¤
  - ì»¨ë””ì…˜ ì¡°ì ˆë§Œ ì˜ í•˜ì! (íŠ¹íˆ ìˆ˜ë©´ë¦¬ë“¬)



## ì˜¤ëŠ˜ì˜ í˜¸ëˆ…ìŠ¤ ìˆ˜ì—…

### DB ì ‘ê·¼

DBëŠ” ì˜¤ì§ **ì›¹ì„œë²„**ë§Œ ì§ì ‘ ì ‘ê·¼ ê°€ëŠ¥í•´ì•¼ í•œë‹¤! (ì ‘ê·¼ ê°€ëŠ¥í•œ ì„œë²„ë¥¼ ë”°ë¡œ ë‘ì–´ì•¼ í•œë‹¤ - SSH ë˜ëŠ” Bastion ë“±) ì‚¬ì¥ë‹˜, ê°œë°œì ëª¨ë‘ ì ‘ê·¼í•  ìˆ˜ ì—†ì–´ì•¼ í•œë‹¤.

DBëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì™¸ë¶€ ì ‘ì†ì´ ì°¨ë‹¨ë˜ì–´ ìˆë‹¤. ì™¸ë¶€ ì ‘ì†ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” bind-addressë¥¼ ìˆ˜ì •í•´ ì£¼ì–´ì•¼ í•œë‹¤.

### [Locale ë¡œì¼€ì¼](https://ko.wikipedia.org/wiki/%EB%A1%9C%EC%BC%80%EC%9D%BC)

: ì‚¬ìš©ìì˜ ì–¸ì–´, êµ­ê°€ ë“± ì‚¬ìš©ìê°€ ì„ í˜¸í•˜ëŠ” ì‚¬í•­(ì–¸ì–´, ì‹œê°„, í™”íë‹¨ìœ„ ë“±ë“±)ì„ ì§€ì •í•œ ë§¤ê°œë³€ìˆ˜ì˜ ëª¨ì„ì„ ë§í•œë‹¤. 

ë‹¨, ì‹œê°„ì€ ìš”ì¦˜ì€ UTCë¡œ í†µì¼í•´ ì‚¬ìš©í•œë‹¤.

- ë‹¨ì  : ë¡œì»¬ íƒ€ì„ìœ¼ë¡œ ë§¤ë²ˆ ë³€í™˜í•´ì•¼ í•œë‹¤
- ì¥ì  : êµ­ì œì ì¸ ì„œë¹„ìŠ¤ê°€ ë˜ì—ˆì„ ë•Œ í¸í•˜ë‹¤ (í•œêµ­ ì‹œê°„ìœ¼ë¡œ í•´ë‘ë©´ ì„œë¹„ìŠ¤ ìˆ˜ì¶œí•  ë•Œ ì¼ì¼ì´ ë°”ê¾¸ì–´ì•¼ í•´ ë§¤ìš°ë§¤ìš° ë¶ˆí¸í•˜ë‹¤)

### [db collation ì½œë ˆì´ì…˜ ](http://jinolog.com/programming/mysql/2011/03/21/character-set-and-collation.html#:~:text=%EB%AC%B8%EC%9E%90%EC%85%8B(Character%20set)%EC%9D%80%20%EA%B0%81,%ED%95%A0%EB%95%8C%20%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94%20%EA%B7%9C%EC%B9%99)

DBì—ì„œ Character Set ì†ì„±ê³¼ Collation ì†ì„±ì´ ìˆë‹¤.

- Character Set (ë¬¸ìì…‹) : ê° ë¬¸ìê°€ ì»´í“¨í„°ì— ì €ì¥ë  ë•Œ ì–´ë–¤ ì½”ë“œë¡œ ì €ì¥ë ì§€ì— ëŒ€í•œ ê·œì¹™ì˜ ì§‘í•©
- Collation(ì½œë ˆì´ì…˜) : íŠ¹ì • ë¬¸ìì…‹ì— ì˜í•´ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ëœ ê°’ë“¤ì„ ë¹„êµ, ê²€ìƒ‰, ì •ë ¬ ë“± ì‘ì—…ì„ ìœ„í•´ ë¬¸ìë“¤ì„ ì„œë¡œ ë¹„êµí•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê·œì¹™ë“¤ì˜ ì§‘í•©ì„ ì˜ë¯¸í•œë‹¤.

ê°™ì€ ë¬¸ìì…‹ì´ë¼ë„ ì½œë ˆì´ì…˜ì— ë”°ë¼ (ì˜ì–´ì˜ ê²½ìš°) ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ë¹„êµ ì—¬ë¶€ê°€ ë‹¬ë¼ì§„ë‹¤.

### ì„¼í‹°ë„¬

ë§¨ ì²« ê°’ì€ ë°ì´í„°ê°€ ì•„ë‹Œ ê°’ì´ë‹¤ (ì»¬ëŸ¼ëª… ë“±)

Statement ëŒ€ì‹  PreparedStatementë¥¼ ì“°ëŠ” ì´ìœ 

: PreparedStatementëŠ” ë§¤ë²ˆ ì»´íŒŒì¼í•˜ì§€ ì•Šì•„ë„ ë˜ë©°, ê°’ë§Œ ë°”ê¿”ì¹˜ê¸°í•¨. ë³´ì•ˆê³¼ ì„±ëŠ¥ ë•Œë¬¸ì— ì‚¬ìš©.

### ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ 'ê´€ê³„'ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ 

: í…Œì´ë¸” ê°„ ê´€ê³„ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ëª¨ë“  ë°ì´í„°ë¥¼ í•˜ë‚˜ì˜ í…Œì´ë¸”ë¡œ ë§Œë“¤ë©´ ë°ì´í„°ì˜ ì¤‘ë³µì´ ë„ˆë¬´ ë§ì´ ë°œìƒí•˜ê³ , ì´ìƒí˜„ìƒ(ë…¼ë¦¬ì ìœ¼ë¡œ ë§ì§€ ì•ŠëŠ” ìƒí™©)ì´ ìƒê¸´ë‹¤.

### ê¸°íƒ€

- ê°œë°œì€ í•­ìƒ ë¡œì»¬DB, ë°°í¬ëŠ” AWS DBë¥¼ ì‚¬ìš©í•œë‹¤.
  - ëˆì´ ë§ìœ¼ë©´ AWS DBë¥¼ 2ê°œ ì‚¬ìš©í•´ ê°œë°œ ë° ë°°í¬ë¥¼ AWSì—ì„œ í•˜ë©´ ë” ì¢‹ë‹¤.

- ë°°í¬í•  ë•Œ ì‚¬ìš©í•  DBì™€ ê°™ì€ DBë¡œ ë¡œì»¬DBì—ì„œ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

- ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ëª¨ë“  Stringì€ **`%`**ë¡œ ë‚˜íƒ€ë‚¸ë‹¤. (`*`ì´ ì•„ë‹˜)

### JDBC ì˜ˆì œ ì½”ë“œ

```java
import org.junit.jupiter.api.*;
import static org.assertj.core.api.Assertions.*;
import java.sql.*;
public class MySqlTest {
    static Connection conn;
    @BeforeAll
    @DisplayName("ì»¤ë„¥ì…˜ ìƒì„±")
    static void createConnection() throws SQLException {
        String url="jdbc:mysql://ec2-54-180-134-23.ap-northeast-2.compute.amazonaws.com/tigerdb";
        String user = "scott";
        String password = "tiger";
        //Class.forName("com.mysql.jdbc.Driver");
        conn = DriverManager.getConnection(url, user, password);
        assertThat(conn).isNotNull();
    }
    @AfterAll
    @DisplayName("ì»¤ë„¥ì…˜ ëŠê¸°")
    static void close() throws SQLException {
        conn.close();
    }
    @Test
    @DisplayName("ì‚¬ìš©ì í…Œì´ë¸”ì—ì„œ ì§€ì •ëœ ê°’ì„ ì˜ ì½ì–´ì˜¤ë©´ ì¢‹ê² ë‹¤...")
    void readRecord() throws SQLException {
        assertThat(getNameFromUser(1)).isEqualTo("honux");
        assertThat(getNameFromUser(5)).isNull();
        assertThat(getIdFromUser("honux")).isEqualTo(1);
    }
    //not good example
    String getNameFromUser(int uid) throws SQLException {
        String query = "SELECT NAME FROM USER WHERE UID = " + uid;
        Statement stmt = conn.createStatement();
        ResultSet rs = stmt.executeQuery(query);
        if (!rs.next()) return null;
        return rs.getString("NAME");
    }
    //PreparedStatement
    int getIdFromUser(String name) throws SQLException {
        String query = "SELECT UID FROM USER WHERE NAME=?";
        var pstmt = conn.prepareStatement(query);
        pstmt.setString(1, name);
        ResultSet rs = pstmt.executeQuery();
        if (!rs.next()) return -1;
        return rs.getInt("UID");
    }
}
```



## Herokuë¡œ ìŠ¤í”„ë§ ì•± ë°°í¬í•˜ê¸°

> [ê¸°ë³¸ì ì¸ ë°©ë²•](https://devcenter.heroku.com/articles/deploying-spring-boot-apps-to-heroku), [ë¡œì¹˜ì˜ ë…¸ì…˜](https://www.notion.so/Heroku-65554bca2a36447eabce268220aa44fb), [mainì™¸ì˜ ë¸Œëœì¹˜ë¡œ ë°°í¬í•˜ëŠ” ë°©ë²•](https://2ssue.github.io/programming/heroku-not-master-deploy/)

masterê°€ ì•„ë‹Œ forkí•œ ë¸Œëœì¹˜ëª…ìœ¼ë¡œ ë°°í¬í•´ì•¼ í–ˆëŠ”ë° ëª…ë ¹ì–´ê°€ ì¡°ê¸ˆ ë‹¬ë¼ì„œ ì•ˆ ëë˜ ê±°ì˜€ë‹¤!! 

ë„ì›€ ì£¼ì‹  ê·¸ë£¹ì› coco, sky ê°ì‚¬í•©ë‹ˆë‹¤ğŸ™‡â€â™€ï¸ğŸ™‡â€â™€ï¸

0. ë¨¼ì € Heroku ê³„ì •ì„ ë§Œë“¤ê³  Heroku CLIë¥¼ ë‹¤ìš´ë¡œë“œ, ì„¤ì¹˜í•œë‹¤. (https://devcenter.heroku.com/articles/deploying-spring-boot-apps-to-heroku)

1. í„°ë¯¸ë„ì—ì„œ `heroku login`ì„ ì…ë ¥í•˜ê³  ë§Œë“  í—¤ë¡œì¿  ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•œë‹¤.

2. `heroku keys`ë¥¼ ì…ë ¥í•´ SSH í‚¤ê°€ ì¶”ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê³ , ì•„ë¬´ê²ƒë„ ì—†ìœ¼ë©´ `heroku keys:add`ë¡œ í‚¤ë¥¼ ì¶”ê°€í•œë‹¤.

3. ë°°í¬í•  ìŠ¤í”„ë§ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ìˆëŠ” ë””ë ‰í† ë¦¬ë¡œ ì´ë™í•œë‹¤ (`cd ...`)

4. í•´ë‹¹ ì•±ì— ëŒ€í•œ ê¹ƒ ì €ì¥ì†Œë¥¼ ë§Œë“¤ê³  ëª¨ë“  ì½”ë“œë¥¼ add, commití•œë‹¤ 

5. `heroku create`ë¥¼ ì…ë ¥í•´ Heroku ì•±ì„ ë§Œë“¤ê³  ì›ê²© ì €ì¥ì†Œë¥¼ ìƒì„±í•œë‹¤.

   ì´ë¦„ì€ ëœë¤ìœ¼ë¡œ ì •í•´ì§. ë§ˆìŒì— ë“¤ì§€ ì•Šìœ¼ë©´ `heroku apps:rename`ìœ¼ë¡œ ì´ë¦„ì„ ë°”ê¿€ ìˆ˜ ìˆë‹¤.

   `git remote -v`ë¡œ Heroku ì›ê²© ì €ì¥ì†Œê°€ ì˜ ë§Œë“¤ì–´ì¡ŒëŠ”ì§€ í™•ì¸í•œë‹¤.

6. ë°°í¬ë¥¼ ìœ„í•´ `git push heroku master` ë˜ëŠ” `git push heroku main`ì„ ì…ë ¥í•œë‹¤.

   â— ë§Œì•½ ë°°í¬í•  ë¸Œëœì¹˜ ì´ë¦„ì´ master, mainì´ ì•„ë‹ˆë¼ë©´,

   `git push heroku ë¸Œëœì¹˜ëª…:master` ë¡œ ë°°í¬í•œë‹¤. 

   (Herokuê°€ push ë° ë¹Œë“œë¥¼ ë‹¤ í•´ ì£¼ë¯€ë¡œ ì‹œê°„ì´ ì¡°ê¸ˆ ê±¸ë¦°ë‹¤)

7. ë°°í¬ê°€ ì˜ ë˜ì—ˆë‹¤ë©´ `heroku open`ì„ ì…ë ¥í•´ ë¸Œë¼ìš°ì €ì—ì„œ ë‚´ ìŠ¤í”„ë§ ì•±ì´ ì˜ ì‹¤í–‰ë˜ëŠ”ì§€ í™•ì¸í•œë‹¤



## ìŠ¤í”„ë§ ì•±ê³¼ H2 ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°í•˜ê¸°

ì‚¬ì‹¤ìƒ ë‚´ê°€ ë³´ë ¤ê³  ì •ë¦¬í•œ ê²ƒì´ì§€ë§Œ... ê·¸ë™ì•ˆ ì¸ê°•, ìˆ˜ì—…, ë¯¸ì…˜ í•˜ë©° ë°°ìš´ ê±¸ ìˆœì„œëŒ€ë¡œ ì°¨ê·¼ì°¨ê·¼ ì •ë¦¬í•´ ë³´ì•˜ë‹¤.

(H2ë°ì´í„°ë² ì´ìŠ¤, ìŠ¤í”„ë§ ë¶€íŠ¸, gradle, JPA ì‚¬ìš©)

### 0. H2 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì¹˜ 

H2ëŠ” ê°œë°œ ë° í…ŒìŠ¤íŠ¸, êµìœ¡ ìš©ë„ì˜ DBì´ë‹¤. [í™ˆí˜ì´ì§€](https://www.h2database.com/html/main.html)

-   ê°€ë³ê³ (ìš©ëŸ‰ì´ ì‘ë‹¤) í¸ë¦¬í•˜ë‹¤
-   ì›¹ í™”ë©´ì„ ì œê³µí•´ ì¤€ë‹¤.

ìœ„ í™ˆí˜ì´ì§€ì—ì„œ ë‹¤ìš´ë¡œë“œ ë° ì„¤ì¹˜ í›„ `h2.sh`íŒŒì¼ì„ ì‹¤í–‰í•œë‹¤.

(ê¸°ë³¸ì ìœ¼ë¡œëŠ” í™ˆ(`~`)ì— ì„¤ì¹˜ëœë‹¤)

-   `H2` - `bin` - `h2.sh` ì‹¤í–‰
    -   git bashë¥¼ ì´ìš©í•˜ë©´ í¸í•˜ë‹¤. `cd ~/H2` -  `cd bin`  - `./h2.bat`
    -   ìœˆë„ìš°ëŠ” `h2.bat` (ê¹ƒë°°ì‹œì—ì„œëŠ” `./h2.bat`) ì‹¤í–‰
    -   ë§¥ì€ `./h2.sh` ì‹¤í–‰
    -   ì°¸ê³  : ì¢…ë£ŒëŠ” `Ctrl + c` ë¡œ ì¢…ë£Œ.

ê·¸ëŸ¬ë©´ ì•„ë˜ì™€ ê°™ì€ 'ì›¹ ì½˜ì†”' ì°½ì´ ë‚˜ì˜¨ë‹¤.

![ìŠ¤í”„ë§ H2 ì½˜ì†”](https://user-images.githubusercontent.com/67407678/109979578-62924a00-7d42-11eb-9fcb-2f5d1beb68b7.PNG)

ì²˜ìŒì—ëŠ” ''ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼(`.db`)''ì„ ë§Œë“¤ì–´ì•¼ í•œë‹¤.

-   JDBC URL : í™ˆìœ¼ë¡œë¶€í„°ì˜ íŒŒì¼ ê²½ë¡œë¥¼ ë§í•œë‹¤.
    -   `~/test` í™ˆì—ì„œ testíŒŒì¼ì„ ë§í•¨.
    -   `test`ë¶€ë¶„ì„ ìì‹ ì˜ í”„ë¡œì íŠ¸ëª…ìœ¼ë¡œ ë°”ê¿€ ìˆ˜ ìˆë‹¤
-   ì—´ë¦° ìƒíƒœ ê·¸ëŒ€ë¡œ \[ì—°ê²°\]ì„ ëˆ„ë¥´ë©´ ì°½ì´ ë°”ë€ë‹¤.

í™ˆì—ì„œ `test.mv`ë¼ëŠ” ì´ë¦„ì˜ `.db`íŒŒì¼(ë°ì´í„°ë² ì´ìŠ¤íŒŒì¼)ì´ ìƒê²¼ëŠ”ì§€ í™•ì¸í•œë‹¤.(`cd`, `ls`  ë˜ëŠ” íƒìƒ‰ê¸°ë¡œ ì§ì ‘ í™•ì¸)

>  JDBC URLì²˜ëŸ¼ íŒŒì¼(`test`)ë¡œ ì ‘ê·¼í•˜ê²Œ ë˜ë©´, ì›¹ ì½˜ì†”ê³¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°„ ì¶©ëŒì´ ì¼ì–´ë‚  ìˆ˜ ìˆ
>
> ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ì—°ê²°ì„ ëŠê³ , ë‹¤ì‹œ ì ‘ì†í•˜ê¸° ì „ì—
>
> JDBC URL í•­ëª©ì„ `jdbc:h2:tcp://localhost/~/test` ë¡œ ë°”ê¾¼ ë’¤ ë‹¤ì‹œ \[ì—°ê²°\]í•œë‹¤.
>
> ì´ë ‡ê²Œ ì ‘ì†í•˜ë©´ íŒŒì¼ì— ì§ì ‘ ì ‘ê·¼í•˜ëŠ” ê²Œ ì•„ë‹Œ, ì†Œì¼“ì„ í†µí•´ ì ‘ê·¼í•˜ê²Œ ë˜ì–´ ì—¬ëŸ¬ ê³³ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•´ì§„ë‹¤.

> ë§Œì•½ ì˜ ì•ˆ ë˜ê±°ë‚˜ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´, `rm test.mv.db` ë¡œ `test.mv.db`íŒŒì¼ì„ ì™„ì „íˆ ì‚­ì œ í›„, ì„œë²„ë¥¼ ê»ë‹¤ ì¼  ë‹¤ìŒ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œë„í•´ ë³¸ë‹¤.

### 1. build.gradle, application.properties

`build.gradle`ì˜ `dependencies`ì— ì•„ë˜ ì˜ì¡´ì„±ì„ ì¶”ê°€

```
runtimeOnly 'com.h2database:h2'
implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
```

(â— ìˆ˜ì • í›„ gradleì„ ì—…ë°ì´íŠ¸í•´ì•¼ í•œë‹¤)

`application.properties`ì— ì•„ë˜ ì„¤ì •ì„ ì¶”ê°€

```
spring.datasource.url=jdbc:h2:tcp://localhost/~/java-qna
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect

spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.hibernate.ddl-auto=create-drop

spring.h2.console.enabled=true
spring.h2.console.path=/h2-console
```

- `spring.datasource.url` : H2ì½˜ì†”ì—ì„œ JDBC URL ì— ë„£ì—ˆë˜ ê²½ë¡œì™€ ê°™ì•„ì•¼ í•œë‹¤.
- `spring.jpa.show-sql` , `spring.jpa.properties.hibernate.format_sql`: JPAë¥¼ ì‚¬ìš©í•˜ë”ë¼ë„ ì „ë‹¬ë˜ëŠ” ì¿¼ë¦¬ë¬¸ì„ ì¶œë ¥í•˜ê²Œ í•˜ëŠ” ì˜µì…˜
- `spring.jpa.hibernate.ddl-auto` : í…Œì´ë¸” ìë™ ìƒì„± ì„¤ì •. 
  - `create-drop` : ì„œë²„ ì‹œì‘ì‹œ DB í…Œì´ë¸”ì„ drop(ì‚­ì œ)í›„ ë‹¤ì‹œ ìƒì„±í•¨
  - `validate` : ì„œë²„ ì‹œì‘ì‹œ DB í…Œì´ë¸”ì„ dropí•˜ì§€ ì•ŠìŒ
- `spring.h2.console ...` : H2 DB ì½˜ì†”ì— ëŒ€í•œ ì ‘ê·¼ ì„¤ì •

### 2. DBì— ë„£ì„ í´ë˜ìŠ¤ë¥¼ DBí…Œì´ë¸”ê³¼ ë§¤í•‘

DBì— ë„£ì„ í´ë˜ìŠ¤ (ì—¬ê¸°ì„œëŠ” `User`)ë¥¼ DBí…Œì´ë¸”ê³¼ ë§¤í•‘í•œë‹¤

- JPAëŠ” ORM ê¸°ìˆ ì„ ì‚¬ìš©í•œë‹¤.
  - ORM : Object Relational Mapping, ê°ì²´ - ê´€ê³„í˜•ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ì„ ë§µí•‘í•˜ëŠ” ê¸°ìˆ .

- ë§µí•‘ì€ ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ì´ë£¨ì–´ì§„ë‹¤.

```java
import javax.persistence.*;

@Entity
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, length=20)
    private String userId;

    private String password;
    private String name;
    private String email;
    
    // getter and setter
}
```

- `@Entity` : JPAê°€ ê´€ë¦¬í•˜ëŠ” ì—”í‹°í‹°. DBì˜ í…Œì´ë¸”ëª…ì´ ë¨. 

- `@Id` : PK(Primary Key)ì— ì„ ì–¸í•¨

  - `@GeneratedValue` : DBê°€ í•´ë‹¹ ê°’ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ê²Œ í•¨.

- `@Column` : DB í…Œì´ë¸”ì˜ ì¹¼ëŸ¼ê³¼ ë§µí•‘í•  ìš”ì†Œë¥¼ ì„ ì–¸

  - `nullable` : ìƒëµ ê°€ëŠ¥í•œì§€ì— ëŒ€í•œ ì†ì„±. ê¸°ë³¸ì ìœ¼ë¡œ true.
  - `length` : ìµœëŒ€ ê¸¸ì´ì— ëŒ€í•œ ì†ì„±.

- â— ë°˜ë“œì‹œ ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ë³€ìˆ˜ì— ëŒ€í•œ getter, setterë¥¼ êµ¬í˜„í•´ ë‘ì–´ì•¼ í•œë‹¤. 

  (ê·¸ë˜ì•¼ ìŠ¤í”„ë§ì´ ìë™ìœ¼ë¡œ ê°’ì„ ë„£ê³  ëº„ ìˆ˜ ìˆë‹¤)

### 3. CRUD êµ¬í˜„ - ì¸í„°í˜ì´ìŠ¤ ì„ ì–¸

```java
import com.codessquad.qna.User;
import org.springframework.data.repository.CrudRepository;

public interface UserReopsitory extends CrudRepository<User, Long> {
}
```

- `CrudRepository<?, ?>` : ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†í•˜ë©´ CRUD ê¸°ë³¸ ê¸°ëŠ¥ì„ ì§€ì›ë°›ì„ ìˆ˜ ìˆë‹¤.
  - `<?, ?>` : ì™¼ìª½ ?ì—ëŠ” DBì— ë„£ê³  ë¹¼ëŠ” ê°ì²´ (ì—¬ê¸°ì„œëŠ” `User`)ë¥¼, ì˜¤ë¥¸ìª½ ?ì—ëŠ” Primary Key(ì—¬ê¸°ì„œëŠ” `id`)ì˜ íƒ€ì…(`Long`)ì„ ë„£ì–´ ì¤€ë‹¤.
- í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì„ ì–¸í•˜ë©´ ìŠ¤í”„ë§ì—ì„œ ìë™ìœ¼ë¡œ ê·¸ êµ¬í˜„ì²´ë¥¼ ë§Œë“¤ê³ , ìŠ¤í”„ë§ ë¹ˆì— ë“±ë¡í•´ ì¤€ë‹¤.

### 4. Controllerì—ì„œ DB ì‚¬ìš©

- ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ, ì„ ì–¸í•œ ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ë¥¼ ì‚¬ìš©í•˜ê²Œ í•œë‹¤.

- `CrudRepository`ì—ì„œ ì§€ì›í•˜ëŠ” ë©”ì†Œë“œë“¤ - `save()`, `findAll()`, `findBy...()` .. ë¥¼ í™œìš©í•´ ì»¨íŠ¸ë¡¤ëŸ¬ì— CRUDë¥¼ êµ¬í˜„í•œë‹¤.

```java
import com.codessquad.qna.User;
import com.codessquad.qna.repository.UserReopsitory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.servlet.ModelAndView;

import java.util.ArrayList;
import java.util.List;

@Controller
public class UserController {

    @Autowired
    private UserReopsitory userReopsitory;

    @PostMapping("/user/create")
    public String createUser(User user) {
        userReopsitory.save(user); // ì €ì¥
        return "redirect:/users";
    }

    @GetMapping("/users")
    public String showUser(Model model) {
        Iterable<User> allUsers = userReopsitory.findAll(); // ëª¨ë‘ ì¡°íšŒ
        model.addAttribute("users", allUsers);
        return "list";
    }

    @GetMapping("/users/{id}")
    public ModelAndView showProfile(@PathVariable Long id) {
        ModelAndView mav = new ModelAndView("profile");
        mav.addObject("user", userReopsitory.findById(id).get()); // 1ê°œ ì¡°íšŒ(idë¥¼ ì‚¬ìš©)
        return mav;
    }
    
    // codes..
}
```

- `@Autowired` `private UserReopsitory userReopsitory;`

  : ìŠ¤í”„ë§ì´ ìë™ ìƒì„±í•´ ì¤€ UserRepositoryì˜ êµ¬í˜„ì²´ë¥¼, ì¸ìŠ¤í„´ìŠ¤ë³€ìˆ˜`UserRepository`ì— ì£¼ì…í•´ ì¤€ë‹¤

ì´ì œ ìŠ¤í”„ë§ ì•±ì„ ì‹¤í–‰í•˜ê³  ë¸Œë¼ìš°ì €ì—ì„œ í…ŒìŠ¤íŠ¸í•œ ë’¤ H2ë¥¼ í™•ì¸í•˜ë©´ ê°’ì´ ì˜ ë“¤ì–´ê°€ ìˆì„ ê²ƒì´ë‹¤.



---



### TODO

- [í´ë¼ìš°ë“œì™€ AWSê°•ì˜](https://www.inflearn.com/course/aws-starter/dashboard) ë“£ê¸°
  - ìƒˆë¡œ ì—…ë¡œë“œí•˜ì‹¤ ê°•ì˜ë„ ë“£ê¸°!
- Logger, LoggerFactory ê³µë¶€í•´ì„œ ì‚¬ìš©í•˜ê¸°
- ìŠ¤í”„ë§ ì˜ˆì™¸ì²˜ë¦¬ ê³µë¶€í•´ì„œ ì‚¬ìš©í•˜ê¸°