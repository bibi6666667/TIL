**[210413]**



- 오늘 한 일
  - 수업 듣기
  - AWS 핵심 강의 이어서 듣기(당장 필요한 부분만)
- 배운 점
  - AWS의 핵심 서비스들을 간략하게나마 알게 됨
  - 의존성 주입에 대해 약간 알게 됨
- 개선할 점
  - 공부는 했지만 코딩을 전혀 안 했다. 내일은 꼭 해야지..



## 수업 정리 - 의존성 주입 

의존성 주입 Dependency Injection

### OOP(객체지향프로그래밍)의 특징

- Encapsulation
- Inheritance
- Abstraction 
- Polymorphism 

### Solid 원칙

- Single Responsibility Principle
- Open / Closed Principle 
- Liskov's Substitution Principle
  - 상위 타입이 하위 타입으로 항상 변경 가능해야 한다. (하위 타입의 실행 결과가 상위 타입의 결과와 다르면 안 된다)
  - `List list = new ArrayList()`
- Interface Segregation Principle
  - 범용 인터페이스 하나보다는 전용 인터페이스 여러 개를 만들어라.
- Dependency Inversion Principle 의존성 역전 원칙

### Spring Triangle

- Aspect Oriented Programming 관점 지향 프로그래밍 (AOP)
  - 인터셉터, 수평관심사(cross cutting concern)
  - 대표적으로 세션, 로깅, 트랜잭션, `System.currentTimeMillies()`(시간측정)에 사용한다.
- Inversion of Control
- Portable Service Abstraction 서비스 추상화
  - 다양한 서비스의 인터페이스 제공
  - 예 - MySQL이나 H2나 상관없이 같은 인터페이스로 서비스 제공

application context

빈은 빈끼리 의존성을 가진다.



## EC2 실습1

### EC2에 elastic-ip 연결하기 

- 안 쓰는 인스턴스는 중지 또는 종료하기
  - 다음에 다시 써야 한다면 중지하기
  - 새로 만들 예정이면 종료하기
- 중지 후 재시작하면 IP가 변경된다.
  - 따라서 고정 IP가 필요하다면 ElasticIP(탄력적IP)를 이용한다.
- ElasticIP
  - AWS에서 제공하는 고정IP.
  - 실제 서비스라면 당연히 IP가 변하면 안 되므로 탄력적IP를 사용해야 한다.

#### 탄력적IP elasticIP

0. AWS 콘솔에서 [탄력적 IP]
1. [탄력적 IP 주소 할당]
2. AWS가 제공하는 IP 풀에서 생성하거나([할당]), 내가 보유한 IP로 생성할 수 있다.
3. IP가 생성되면 Name을 편집해 이름을 붙여 준다.
4. [탄력적 IP 주소 연결] 선택
5. IP 주소에 연결할 인스턴스를 선택 (현재 실행 중인 인스턴스)

### elastic-ip 연결 해제

#### elasticIP 주의사항

- 사용 중에는 무료, 반대로 사용하지 않을 때 과금(월4000원 정도) 된다.
  - 즉 ElasticIP가 인스턴스와 연결되어 있지 않을 때 과금
  - 또는 ElasticIP와 연결된 인스턴스가 중지 상태일 때 과금
- 프리티어 사용자가 요금을 지불하게 되는 원인 중 하나.
- 과금되지 않기 위해, 사용하지 않을 때는 반드시 반납해야 한다.

#### elasticIP 연결 해제하기

- AWS 콘솔 - 탄력적IP - ip선택 - [작업] - [탄력적 IP주소 연결 해제] 하면 해제된다.

#### elasticIP 주소 릴리즈?

= elasticIP를 삭제하는 것.

같은 탄력적IP를 다시 받을 방법이 없으니, 서비스 중인 IP는 절대 삭제해서는 안 된다.

## EC2 실습 2

### EBS 스냅샷 생성

- EBS 스냅샷

  : 가장 간단한 EBS 데이터 백업방법

- **리전 서비스**

- 스냅샷은 안전하게 S3에 저장됨

- 변경만 내용만큼만 백업되므로 용량 및 비용 효율적

- 실행 중인 인스턴스에서도 생성 가능하지만, 가급적 ''정지 후에 생성''하는 게 좋음

- EBS는 AZ서비스(한 AZ에서 다른 AZ로 옮길 수 없음)이지만, 스냅샷은 리전서비스임.

  - 따라서 스냅샷을 이용해 다른 AZ로 복사 가능!

#### 스냅샷 생성하기

0. AWS 콘솔 - [스냅샷]
1. [스냅샷 생성]
2. instance 선택 후 현재 실행 중인 인스턴스 선택
3. 이름(설명) 지정
4. 태그 지정 (Name 정도)
5. 생성될 때 까지는 시간이 조금 걸린다.

#### 스냅샷으로 EBS 만들기

0. AWS 콘솔 - [볼륨] 선택

   볼륨의 가용영역과 다른 영역에 EBS 생성 가능!

1. [작업] - [볼륨 생성]

2. 모두 기본값으로 선택 후, 가용 영역만 기존 볼륨과 다른 가용영역으로 생성 

### AMI 생성 및 인스턴스 생성

AMI = Amazone Machine Image

- EC2의 백업 이미지
- EBS 스냅샷 + 메타데이터 로 구성됨
- AMI를 이용해 EC2를 다른 AZ로 옮길 수 있음.
  - (EC2는 AZ서비스이지만 AMI는 리전 서비스이므로)

#### AMI 생성하기

0. 실행 중인 인스턴스 중지시키기

1. AWS 콘솔 - [작업] - [이미지 및 템플릿] - [이미지 생성]

2. 이미지 생성 

   이미지 이름은 적당히 적기. 나머지는 기본값으로 두고 생성.

3. AWS 콘솔 - [AMI]에서 생성 중인 이미지 확인 가능.

4. AWS 콘솔 - [스냅샷]에서도 확인 가능.

   (AMI가 스냅샷+메타데이터 로 구성되므로, 생성 시 스냅샷과 AMI가 둘 다 생기며, 삭제할 때도 스냅샷과 AMI를 둘 다 지워야 한다)

#### AMI를 가지고 인스턴스 새로 만들기

0. AMI 선택 후 [작업] - [시작하기]
1. 인스턴스 생성 창이 나옴. 평소처럼 기본 값으로 두기
   - 네트워크의 "서브넷"에서 이전 인스턴스와 다른 가용영역에 생성 가능!
2. 스토리지는 기본값으로 두고 다음
3. 태그는 `Name`만 설정
4. 보안 그룹, 키 페어 모두 기존 것으로 사용
5. 기존과 똑같은 내용을 가진 새로운 인스턴스가 생성된다.

❗ 실습 후 만들어진 AMI, 스냅샷은 반드시 삭제한다 (프리티어가 끝나고 나면 과금되기 때문)

### EC2-meta-data

EC2 메타데이터

: EC2 인스턴스 자체의 정보를 확인할 때 사용

- `$ curl -w '\n' http://169.254.169.254/latest/meta-data`
  - `curl` : http 요청을 보내 응답을 받을 때 사용하는 명령.

0. 실행 중인 EC2 인스턴스를 주소로 연결
   - `ssh -i 키파일이름.pem 사용자이름@퍼블릭IP주소`
   - [인스턴스] - [인스턴스에 연결] 페이지 내용을 참고.
1. 연결 후 `$ curl -w '\n' http://169.254.169.254/latest/meta-data`  실행하면 EC2인스턴스의 정보들을 확인할 수 있다.
   - `$ curl -w '\n' http://169.254.169.254/latest/meta-data/public-ipv4`
     - 인스턴스의 퍼블릭DNS(IP) 확인 가능
   - `$ curl -w '\n' http://169.254.169.254/latest/meta-data/ami-id`
     - 인스턴스의 ami 아이디 확인 가능
   - `$ curl -w '\n' http://169.254.169.254/latest/meta-data/instance-id`
     - 인스턴스의 아이디 확인 가능
2. 이런 메타데이터들을 활용해 사용할 수 있다!

### EC2 Role 사용해 보기

- EC2 인스턴스가 다른 AWS리소스를 제어할 때 사용하는 IAM Role
  - EC2 안에서 CLI 설정을 할 수 있지만, EC2 Role을 사용하는 게 더 안전하다
- EC2 Role을 사용하기 위해서는 추가적인 IAM권한이 필요하다

이하 내용은 지금 단계에서는 이른 것 같아 끝까지 보지 않았다.

### EC2 팁 및 마무리

#### EC2 유형 변경

- 실행 중 : 유형 변경 불가능
- 중지 상태 : 유형 변경 가능 (인스턴스 크기 조정 가능)
- 보안 그룹 : 실행 중에도 추가, 변경, 삭제 가능
- EC2 Role도 실행 중 변경 가능
- 키페어는 변경 불가능
- 프라이빗, 퍼블릭IP는 변경 불가능
  - 퍼블릭IP는 elasticIP를 활용할 수 있음

#### EC2의 상태 및 요금 과금 정책

- 시작 
  - 처음 EC2를 생성함
- 실행 중
  - 현재 서버가 동작 중인 상태
  - EC2(서버) 요금 + EBS(저장장치) 요금 + 네트워크 요금 으로 과금
- 정지
  - EC2 요금, 네트워크 요금은 나오지 않는다
  - EBS요금은 과금될 수 있다
- 종료
  - 생성된 EC2가 완전히 사라진 상태
  - 기본 옵션으로 EBS도 함께 사라짐(옵션을 해제해 EBS가 삭제되지 않은 경우 과금될 수 있다)

#### EC2가 종료되었는데 과금이 되었다면?

- Elastic IP
  - 만들어 놓고 사용하지 않으면 과금
- EBS 스냅샷
  - 스냅샷이 남아 있다면 S3 용량만큼 과금
- AMI
  - AMI가 남아 있다면 역시 SC 용량만큼 과금
  - 특히 AMI를 제거했지만 스냅샷은 남아있어 과금되는 경우가 많으므로 주의.

## VPC 

### VPC 소개

VPC = Amazon Virtual Private Cloud

- AWS의 가상 사설 네트워크 
- AWS를 잘 사용하기 위해서 익혀야 하는 필수 지식
- EC2의 네트워크 계층을 담당함 
- 많은 AWS 서비스들이 VPC를 통해 네트워크에 연결됨.

#### VPC를 이용한 네트워크 구성 예제

![VPC](https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/images/nat-gateway-diagram.png)

### VPC 주요 개념

- VPC 
  - 사용자의 AWS 계정 전용 가상 네트워크 망
  - 리전 서비스 
  - 위 그림의 주황색 구름 VPC 영역.
- 서브넷 
  - VPC를 더 작은 범위의 네트워크 나눈 것
  - AZ 서비스 (서브넷 생성시 AZ를 직접 선택해야)
  - 위 그림의 자물쇠 모양 영역.
  - EC2 인스턴스는 반드시 서브넷에 연결된다. VPC에 직접 연결되지 못한다.
  - 왜? EC2는 AZ서비스이므로 같은 AZ서비스인 서브넷에 연결 가능. 또, 개념적으로도 인스턴스(=컴퓨터)가 여러 데이터 센터에 연결될 수 없기 때문.
- 라우팅 테이블 
  - 네트워크 트래픽 전달 규칙 지정 
  - 위 그림의 표 모양이 라우팅 테이블.
  - 서브넷에 연결되어 라우팅 규칙을 정의함.
- CIDR 블록
  - 네트워크는 IP 범위를 지정해야 한다. VPC도 네트워크이므로 범위를 지정해야.
  - CIDR 표기법을 통해 VPC의 IP 주소 범위를 지정한다.

...

## RDS

### RDS 소개 및 특징

RDS = Amazone Relational Database Service.

- AWS에서 관계형 데이터베이스를 쉽게 사용할 수 있게 도와주는 서비스
- 장점 : 관계형 데이터베이스 관리의 부담을 대폭 덜어준다
- 단점 : 추가적인 비용이 발생한다.

#### 관계형 데이터베이스(RDBMS)

- 테이블 모양의 2차원 데이터 (행과 열 / 레코드와 필드) 를 저장함
  - 엑셀, 구글 스프레드시트를 생각하면 된다
  - tabula structure (테이블 모양의 데이터 저장)
- 데이터와 데이터 사이의 관계를 활용하여, 중복데이터를 방지하고 검색 성능을 높임
- 가장 대표적인 데이터베이스의 형태
- Oracle, MySQL, MS-SQL Server 등이 가장 유명함

#### RDS에서 지원하는 관계형 데이터베이스

- Oracle, MySQL, MariaDB, Aurora, PostgreSQL, SQL Server

### RDS의 장단점

#### RDS 사용의 장점

- 쉬운 데이터 백업, 복구
- 고가용성 확보
  - 사용하던 DB에 장애가 생긴 경우, 백업해 둔 DB가 primary DB가 되는 기능이 있다.
- 수직 확장, 수평 확장 시 다운타임 최소화
- AWS 타 서비스들과의 통합이 편리
- 다양한 기능
- 높은 성능

#### RDS 사용의 단점

- 비싸다.
  - 최소 중견기업 이상이어야..
  - EC2 한 대를 운영하는 가격의 4배 정도?
- 완전 최적화(커스터마이즈)가 어렵다.
  - AWS에서 제공해 주는 기능을 사용해야 하기 때문
- 특정 벤더들의 경우 벤더사의 클라우드 제품이 더 유리할 수 있다.
  - Oracle - Oracle Cloud 같은 전용 클라우드가 존재

...