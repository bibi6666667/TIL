**[210412]**



- 오늘 한 일
- 배운 점
- 개선할 점



---

## 수업 정리

IAM

: AWS에서만 사용하는 단어가 아니다!

IAM은 인증과 권한 관리 - AWS 자원에 대한 접근을 안전하게 관리하도록 도와 주는 서비스.

= 방법은 제공해 주지만 책임은 우리 몫이다 (반반책임)

IAM Policy 표시

Version : 날짜는 고정이다. 현재 날짜 아님

Action : 주로 우리가 사용하는 API

NotAction : 해당 기능들은 사용할 수 없음

> organizations : 여러 AWS계정을 함께 관리할 수 있게 해 주는 서비스.

기본적으로 모든 사용자는 Implicite 디나이 상태 (아무것도 할 수 없다)

명시적으로 어떤 접근을 할 수 없게 하려면 ED - Explicite 디나이 로 설정하면 된다. (다른 곳에서 다 허용해도 ED가 설정되어 있으면 할 수 없다)



AWS CloudTrail : 클라우드의 모든 활동들을 추적할 수 있는 서비스.

IAM Role (역할)

- 그룹이랑 거의 똑같음

- 차이점

  - 그룹은 사용자만 들어갈 수 있지만, Role은 사용자가 아닌 아무거나에게 권한을 부여할 수 있다.  예를 들어 AWS의 다른 서비스에게 권한을 부여할 수 있음.

    (인스턴스 생성 시 IAM Role 부여 등)

  - Role은 사용 대상을 지정할 수 있다(신뢰관계)

  - 작업이 필요할 때만 사용하는 임시 자격부여 서비스. 

  - 일정 시간이 지나면 만료된다. (세션과 비슷하다!)

> Role을 사용하는 것을 assume role 이라고 한다



### IAM Role 사용 예

- EC2 role: EC2 인스턴스에게 AWS 서비스 접근권한을 부여
- Lambda Execution Role: 람다에서 S3로부터 파일을 읽고 싶을 때 role에 권한 지정
- 다른 계정의 사용자에게 내 계정의 DynamoDB에 임시 접근 권한 부여
  - 예를 들어 DB 컨설팅을 받고 싶을 때, 컨설턴트에게 DB 접근권한을 임시로 부여하기 위해 Role을 사용
- 안드로이드 앱이 S3로 직접 동영상을 업로드할 때 사용
  - 앱이 스토리지에 바로 데이터를 올리는 것.
  - (앱에 하드코딩으로 AWS 아이디, 패스워드를 넣으면 절대 안 된다)

#### ARN

= Amazon Resource Name
아마존에서 리소스를 유일하게 식별할 수 있는 구분자.

- 패턴
  - `arn:partition:service:region:account-id:resource-id`
    `arn:partition:service:region:account-id:resource-type/resource-id`
    `arn:partition:service:region:account-id:resource-type:resource-id`

- 예시
  - `arn:aws:iam::123456789012:user/honux`
  - `Arn:aws:s3:::my-bucket/folder1/file1`



## IAM Role 실습

### Switch Role 만들기

### Switch Role 사용하기

### CLI 설치 및 간단히 사용해 보기

### CLI에서 IAM Role 사용해 보기



## S3

### S3소개

AWS의 대표적인 서비스 - 서버(EC2), 스토리지(S3).

- 객체(=파일) 스토리지
  - 구글 드라이브 같은 개념이다.
- 파일 업로드, 다운로드, 검색 가능 
- 무제한 용량!
  - (돈을 낼 수 있는 한..)
- 다양한 인증 / 권한 부여 제공

#### S3의 특징

- 리전 기반 서비스 
  - = 데이터센터가 분산되어 있는 것과 같다.

- 매우 안전 (99.999999999% 내구도를 가짐)
- 상대적으로 빠르지는 않다. 
  - 비용을 더 들이면 성능을 높일 수 있다.
- cloud front(CDN)과 연동 가능 
- static web page 기능 지원 
  - 간단한 웹서버 기능을 할 수 있다.
- 필요에 따라 버저닝(versioning) 기능 사용 가능 
  - 이름이 같은 파일을 네 번 저장하면, 각 버전별로 저장해 둔다.
  - 활성화/비활성화 기능
- 다양한 요금 옵션으로 비용 절감 가능(비용최적화 가능)

### S3 사용 예

- 클라우드 저장소 (개인 파일 보관, 구글 드라이브처럼 사용 가능) 
- 서비스의 대용량 파일 저장소 - 이미지, 동영상, 빅데이터 (ex: 넷플릭스 컨텐츠) 
- 서비스 로그 저장 및 분석
  - 서버 컴퓨터에 서비스 로그를 저장하는 것은 굉장한 안티패턴이다. (비용, )
-  AWS 아데나를 이용한 빅데이터 업로드 및 분석 
  - 데이터 분석 저장소로 사용
- 서비스 사용자의 데이터 업로드 서버 (이미지 서버, 동영상 서버) 
  - 예 ) 인스타그램 회원들이 올리는 사진들의 저장소
- 중요한 파일은 EC2의 SSD (EBS)에 저장하지 말고 S3에 저장하자
  - EBS : elastic block storage (안정성 99%)
- glacier와의 연동으로 비용 절감 및 보안 규정 준수 가능
  - glacier (차가운=자주 사용하지 않는 데이터 저장소)

..

## EC2

### EC2 소개

= Elastic Computing Cloud 

- 안전하고 확장성 있는 컴퓨팅 서비스 

- Instances 

- Containers (도커, 쿠버네티스..)

- Serverless (람다)
  - 서버(인스턴스) 없이 코드를 실행할 수 있다.
  - 탄력성이 높은 서비스를 만들 수 있다. 
- Hybrid 
  - AWS + 물리적 데이터센터 를 조합해서도 사용할 수 있다.

#### EC2 특징

- 사용한만큼 요금 지불, 초당으로 계산된다. 
  - 사용하지 않을 때는 즉시 정지해야.
  - 잘못 사용하면 IDC에서 서버를 임대하는 것보다 비쌀 수 있다. 

- 전세계 어디든지 빠르게 인스턴스를 생성하고 서비스 운영 가능
-  ELB, Auto Scaling, S3등 다양한 서비스와 연동
-  Linux, Windows, MacOS 지원

### MultiAZ와 고가용성

EC2는 AZ기반 서비스이다.

- EC2 와 주요 구성요소들은 AZ 기반이다.
  - 리전이 아닌 데이터센터(가용영역) 기반 이다.
- 고가용성을 위해서는 MultiAZ를 이용 가용성을 확보해야 한다.
  - MultiAZ : 둘 이상의 AZ에 서버를 분배하여 구축하는 것.
- Multi AZ
- 둘 이상의 AZ를 활용해서 서비스를 구축하는 것
- 두 대 이상의 서버가 필요
- 주로 ELB (Elastic Load Balancer)를 이용해서 서버를 연결해서 사용함

### EC2 관련 서비스들

- EC2 : 서버, 주로 CPU + Memory
- EBS (Elastic Block Storage) : EC2의 블록 저장장치(SSD). AZ 서비스.
- VPC (Virtual Private Cloud) : EC2가 연결되는 사설 네트워크 망, **리전 기반**
  - MultiAZ를 구현할 수 있는 이유.
- Subnet : VPC의 하위망. AZ 서비스.
  - **EC2는 subnet에 연결됨!**
- ENI (Elastic Network Interface) : 가상 네트워크 인터페이스, 랜카드, AZ 서비스
- security group : EC2의 방화벽, 포트 접근 제어
  - inbound, outbound (드나드는 네트워크 패킷들)을 제어함

- ELB (Elastic Load Balancer) : 트래픽 분산을 위해 사용
- Auto Scaling : EC2의 확장성을 위해 제공되는 서비스. 매우 유명하다
  - 트래픽에 맞춰 자동으로 서버를 늘리거나 줄여 주는 서비스.
- EBS Snapshot : EBS의 데이터를 백업하는 서비스.
  - EC2 디스크만 백업한다.
- AMI (Amazon Machine Image) : EC2의 백업 이미지, EC2를 시작할 때 사용 
  - EC2 인스턴스를 백업한다.
  - AWS에서 제공하는 AMI를 이용해서 EC2 시작
  - 사용자가 원하는 시점에 AMI를 생성하고 이를 통해 EC2 시작 가능

### VPC-ELB-EC2를 이용한 구성 예제

![img](https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2019/10/06/illustration-2.png)

위 그림은 VPC, ELB, EC2를 개략적으로 나타낸 것이다.

EC2를 가장 간단하게 구성하는 예제라고 할 수 있다.

- AWS Cloud : AWS 전체.
- VPC = 연두색
- ELB = 보라색
  - Application Load Balancer(ALB)
  - 트래픽을 분산시키는 역할.
- AZ1, AZ2 = 파란색
  - 두 AZ로 분리되어 있음
- Instance = 노란색
  -  서버. 총 4대의 서버가 두 AZ에 분산되어 있다.

### EC2 유형과 비용

AZ마다 지원되는 인스턴스의 종류가 다름 .

#### 인스턴스

애플리케이션 유형에 따라 다양한 인스턴스를 선택할 수 있다.

인스턴스의 유형에 따라 CPU, 메모리, 네트워크, 디스크 IO 성능 등이 다르다. 

1. 범용 인스턴스
   - Mac
     - Mac은 일당 요금으로 측정됨 (상당히 비싼 편)
   - T 시리즈 (`T...`)
     - 가장 저렴하다
     - Arm기반 또는 intel기반으로 동작
     - ''시간당 CPU 크레딧''이라는 개념이 있다.
   - M 시리즈(`M...`)
     - 가장 많이 사용된다 (가장 일반적)
     - CPU, 메모리 선택 폭이 넓음
2. 컴퓨팅 최적화 인스턴스
   - CPU 성능이 좋은 인스턴스
3. 메모리 최적화 인스턴스
   - 메모리가 좀 더 많은 인스턴스
4. 가속화된 컴퓨팅 인스턴스 
   - GPU가 붙어 있는 인스턴스 (빅데이터, 딥러닝 .. 에 사용)
5. 스토리지 최적화 인스턴스
   - 디스크 작업이 많을 때 쓰는 인스턴스

#### 요금

- 온디맨드
  - 리전마다 다름
  - 인스턴스 유형을 보고 요금을 반드시 확인해야 한다.
  - 예약이 가능하다 : 예약 후 인스턴스 사용 시 약간 금액이 할인된다.

- 스팟 인스턴스
  - 안 쓰는 인스턴스를 싸게 구매 가능 (경매 방식)
  - 단점 - 나보다 높게 입찰한 사용자가 생기면 내가 사용 중인 인스턴스가 1분 후 강제 종료됨
  - 효율적으로 사용하는 방법을 구글링해 알아본다.

- 스팟 인스턴스: 입찰 방식, 상위 입찰시 인스턴스 강제 종료 
- 용량 예약: 예약을 통해 다양하게 할인받을 수 있음. 잘 사용하면 비용 절감 가능

## EC2 실습 1

### EC2 인스턴스 생성

*콘솔에 로그인하면 항상 내 계정이 맞는지, 올바른 리전에 있는지 확인해야 한다.

0. 서비스 - [EC2] 선택
1. [인스턴스 시작]
2. AMI 선택 
   - 모든 AWS 인스턴스는 EC2의 백업 이미지인 AMI로부터 시작한다!
   - Amazone Linux AMI를 선택.
   - `x86` 또는 `Arm` 중 선택. 더 많이 사용하는 것은 `x86`
3. 인스턴스 유형 선택
   - 실습용이므로 ''프리 티어 사용 가능'' 한 인스턴스를 일단 선택한다.
4. 인스턴스 세부 정보 구성
   - 인스턴스 개수 : 우선 1개
   - 구매 옵션 [스팟 인스턴스] : 경매 방식
   - 네트워크 : VPC. 기본 VPC를 선택한다
   - 서브넷 : 기본 설정 없음
   - 퍼블릭 IP : 활성화. SSH 접속을 위해 필요
   - 나머지는 모두 기본값으로 둔다.
   - 메타데이터? EC2가 ''생성될 때'' 한 번만 생성되는 스크립트.
5. 스토리지 추가
   - 모두 기본값으로 두고 다음.
6. 태그 추가
   - 필수 : `Name` . 
   - `Environment`
   - `Team`
   - .. 등을 붙일 수 있다.
7. 보안 그룹 (방화벽)
   - 처음이라면 보안 그룹 이름을 설정해야 한다. (`demo-sg` 등)
8. 인스턴스 시작 검토
   - 설정 내용을 확인하고 [시작하기]를 누르면 키 페어 생성 창이 나온다.
   - 처음이면 '새 키 페어 생성' 선택하고 이름을 설정.
   - ❗ [키 페어 다운로드] 를 누르면 생성되는 키 파일은 반드시 잘 관리해야 한다. 분실 시 영원히 그 인스턴스에 로그인할 수 없다.

### EC2 Instance Connect로 접속하기

인스턴스를 생성 후 콘솔에 접속하면 생성된 인스턴스를 확인할 수 있다.

0. [인스턴스 ID] 를 클릭해 인스턴스 관리창에 들어간다.
1. [연결]을 클릭해 '인스턴스 연결'창에 들어간다.
   - 인스턴스 연결에는 EC2 인스턴스 연결 / Session Manager / SSH 클라이언트 의 세 방법이 있다.
2. 가장 쉬운 방법은 EC2 인스턴스 연결 에서 [연결]을 누르는 것이다.

### EC2 정지 / 종료하기

안 쓰는 인스턴스에 대해서는..

- 인스턴스 중지
  - 사용하지 않는 컴퓨터를 끄는 것과 같다.
  - 서버 내의 데이터 등 리소스는 남아 있으므로 요금이 나올 수 있다.
- 인스턴스 종료
  - 더 이상 쓸 일이 없는 컴퓨터를 폐기하는 것과 같다.
  - 요금이 전혀 나오지 않게 하려면 '종료'를 선택한다.

### AWS EC2 접속하기

#### ssh로 접속

- mac, 리눅스 : 터미널을 사용.

- 윈도우 : git bash를 사용.

인스턴스의 [연결] - [SSH 클라이언트] 의 설명을 참고해 따라한다.

0. 인스턴스의 퍼블릭 IPv4 DNS 복사
   - 프라이빗 IP가 아닌 퍼블릭 IP로 복사해야!
1. 터미널을 켜고, 키 페어(PEM) 파일이 존재하는 경로로 이동한다
2. 키 파일을 남들이 읽을 수 없게 권한을 설정한다.
   - `chmod 400 PEM파일이름.pem`
3. 키 파일을 이용해 ssh로접속한다.
   - `ssh -i PEM파일이름.pem 사용자아이디@퍼블릭DNS주소 `

#### windows에서 putty로 접속

위의 방식이 더 간단하다.

https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/putty.html 참고.

### EC2에 elastic-ip 연결하기 

### elastic-ip 연결 해제



## EC2 실습 2

### EBS 스냅샷 생성

### AMI 생성 및 인스턴스 생성

### ec3-meta-data

### EC2 Role 사용해 보기

### EC2 팁 및 마무리



## VPC 

### VPC 소개

### VPC 주요 개념

...



## RDS

### RDS 소개 및 특징

### RDS의 장단점

