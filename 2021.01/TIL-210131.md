**[210131]**



> ì˜¤ëŠ˜ ì €ë…ì—ëŠ” ì–´ì œì— ì´ì–´ì„œ JDBCë¡œ MySQL DB ì—°ê²°ì„ ì—°ìŠµí•´ ë³´ì•˜ë‹¤!
>
> (SELECT ì™€ INSERT)



# TIL



## JDBCë¥¼ ì´ìš©í•œ DB(MySQL) ì—°ê²°í•´ ì‚¬ìš©í•˜ê¸° 

## - SELECT, INSERTë¬¸



*[ë§í¬1](https://victorydntmd.tistory.com/145), [ë§í¬2](https://hsunnystory.tistory.com/160?category=791615)ë¥¼ ì°¸ì¡°í•˜ë©° ì—°ìŠµí•œ ì˜ˆì œì…ë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤ğŸ™‡â€â™‚ï¸
íŠ¹íˆ ë§í¬1 ì¤‘ì‹¬ìœ¼ë¡œ ë”°ë¼í•œ ê²ƒì´ ë§ì€ ë„ì›€ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.



(MySQL connectorê°€ ì¤€ë¹„ë˜ì–´ ìˆë‹¤ëŠ” ì „ì œ í•˜ì— ì‹¤í–‰ê°€ëŠ¥í•œ ì˜ˆì œì…ë‹ˆë‹¤)



#### JDBCë¡œ DB(MySQL) ì—°ê²°í•´ ì‚¬ìš©í•˜ê¸°

1. `import  java.sql.*;`

2. ë“œë¼ì´ë²„ ê°€ì ¸ì˜¤ê¸° - MySQL Connector 
   ` Class.forName("com.mysql.jdbc.Driver");`

3. MySQLì—°ê²°ì„ ìœ„í•œ Connectionê°ì²´ ìƒì„±
   `String url = "jdbc:mysql://localhost/DBëª…";`
   `connection = DriverManager.getConnection(url, "DBì‚¬ìš©ìID", "DBì‚¬ìš©ìPW");`

4. Statement / PreparedStatement ê°ì²´ ìƒì„±

   (ì•„ë˜ `connection`ì€ Connectionê°ì²´)

   - `Statement statement = connection.createStatement();`

     - ì •ì ì¸ ì¿¼ë¦¬ë¬¸, ì¦‰ íŒŒë¼ë¯¸í„°ë¥¼ ì…ë ¥ë°›ì§€ ì•ŠëŠ” ì¿¼ë¦¬ë¬¸ì¼ ë•Œ ì‚¬ìš©

     ì£¼ë¡œ `SELECT` ì¿¼ë¦¬ì— ì‚¬ìš©í•¨.

   - `PreparedStatement preparedstatement = connection.prepareStatement();`

     - ë™ì ì¸ ì¿¼ë¦¬ë¬¸, ì¦‰ íŒŒë¼ë¯¸í„°ë¥¼ ì…ë ¥ë°›ì•„ ì‚¬ìš©í•˜ëŠ” ì¿¼ë¦¬ë¬¸ì¼ ë•Œ ì‚¬ìš©

     ì£¼ë¡œ `INSERT`, `UPDATE`, `DELETE` ì¿¼ë¦¬ì— ì‚¬ìš©í•¨.

     (*PreparedStatement : ì¿¼ë¦¬ë¥¼ ì¤€ë¹„í•˜ëŠ” Statementë¼ëŠ” ì˜ë¯¸. ì…ë ¥ê°’ì„ í•„ìš”ë¡œ í•˜ë¯€ë¡œ.)

5. SQLì¿¼ë¦¬ ìˆ˜í–‰ (`execute`)

   - `executeQuery(SQLë¬¸)` : `SELECT` ì²˜ëŸ¼ ë¦¬í„´ê°’ì´ í•„ìš”í•œ ì¿¼ë¦¬ë¬¸ì¼ ë•Œ ì‚¬ìš©
     - `Statement.executeQuery()`
     - `PreparedStatement.executeQuery()`
     - ë¦¬í„´íƒ€ì… : `ResultSet` ê°ì²´ - ì¿¼ë¦¬ ê²°ê³¼ë¡œ ë¦¬í„´ëœ DB ë ˆì½”ë“œë“¤ì´ ë‹´ê²¨ ìˆë‹¤.
       `ResultSet = statement.executeQuery(sql);`ì™€ ê°™ì´ ì‚¬ìš©.
       `resultSet.next()` :  booleanì„ ë¦¬í„´í•¨ - ë‹¤ìŒ ë ˆì½”ë“œê°€ ì¡´ì¬í•˜ë©´ true ë¦¬í„´.
   - `executeUpdate()`  : `INSERT`, `UPDATE`, `DELETE` ì²˜ëŸ¼ ë¦¬í„´ê°’ì´ í•„ìš” ì—†ëŠ” ì¿¼ë¦¬ë¬¸ì¼ ë•Œ ì‚¬ìš©
     - `Statement.executeUpdate()`
     - `PreparedStatement.executeUpdate`
     - ë¦¬í„´ê°’ ì—†ìŒ

6. ë¦¬ì†ŒìŠ¤ ë°˜ë‚©

   í•„ìš”í•œ ë‚˜ë¨¸ì§€ ë¡œì§ë“¤ì„ ìˆ˜í–‰í•œ í›„, 
   `finally`ë¸”ë¡ì—ì„œ `.close()`ë¡œ JDBC ì—°ê²° ê³¼ì •ì— í•„ìš”í–ˆë˜ ê°ì²´ë“¤ì„ ë°˜ë‚©í•¨.
   (ê°ì²´ë¥¼ ìƒì„±í•œ ì—­ìˆœìœ¼ë¡œ ë°˜ë‚©í•¨)

   - `Connection.close()`
   - `Statement.close()` 
   - `PreparedStatement.close()`
   - `ResultSet.close()` 



### SELECTë¬¸ ì˜ˆì œ

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.Statement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class SelectMySQL {
    public static void main(String[] args) {
        Connection connection = null;
        Statement statement = null;
        ResultSet resultSet = null;

        try {
            // 1. connector (ë“œë¼ì´ë²„) ë¡œë”©
            // ClassNotFoundException ë°œìƒ ê°€ëŠ¥ - try-catch ë¡œ ì˜ˆì™¸ì²˜ë¦¬ í•„ìš”.
            Class.forName("com.mysql.jdbc.Driver");

            // 2. DB(MySQL)ì™€ ì—°ê²°
            // SQLException ë°œìƒ ê°€ëŠ¥ - try-catch ë¡œ ì˜ˆì™¸ì²˜ë¦¬ í•„ìš”.
            String url = "jdbc:mysql://localhost/DBëª…";
            connection = DriverManager.getConnection(url, "DBì‚¬ìš©ìID", "DBì‚¬ìš©ìPW");

            // 3. ì¿¼ë¦¬ ìˆ˜í–‰ì„ ìœ„í•œ Statement ê°ì²´ ìƒì„±
            // (Statement ê°ì²´ : ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê°ì²´)
            // *ì •ì ì¸ ì¿¼ë¦¬ë¬¸ì€ Statement statement = conn.createStatement();
            // *ë™ì ì¸ ì¿¼ë¦¬ë¬¸ì€ PreparedStatement preparedstatement = conn.prepareStatement();
            // (ë™ì ì¸ ì¿¼ë¦¬ë¬¸ = íŒŒë¼ë¯¸í„°ë¥¼ ì…ë ¥ë°›ëŠ” ì¿¼ë¦¬ë¬¸)
            statement = connection.createStatement();

            // 4. SQL ì¿¼ë¦¬ ì‘ì„±
            // ì£¼ì˜ 1. JDBCì—ì„œ ì¿¼ë¦¬ ì‘ì„±ì‹œ ;ë¥¼ ë¹¼ê³  ì‘ì„±í•¨.
            // ì£¼ì˜ 2. SELECT í•  ë•Œ *ë¡œ ê°€ì ¸ì˜¤ëŠ” ê²ƒë³´ë‹¤, ê°€ì ¸ì˜¬ ì»¬ëŸ¼ì„ ì§€ì •í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ.
            // ì£¼ì˜ 3. ì¿¼ë¦¬ë¡œ ê²°ê³¼ê°’ë§Œ ê°€ì ¸ì˜¤ê³ , javaì½”ë“œë¡œ í›„ì‘ì—…í•˜ëŠ” ê²ƒì€ ì¢‹ì§€ ì•ŠìŒ.
            // ì£¼ì˜ 4. ì¿¼ë¦¬ëŠ” ê°€ê¸‰ì  í•œ ì¤„ë¡œ ì‘ì„±. ì¤„ì„ ë‚˜ëˆŒ ì‹œ, ë„ì–´ì“°ê¸°ì— ìœ ì˜.
            String sql = "SELECT nickname, money FROM user_log";

            // 5. SQL ì¿¼ë¦¬ ìˆ˜í–‰
            // ì‘ì„±í•œ SQL ì¿¼ë¦¬ë¥¼ Statement.executeQuery()ì˜ ì¸ìë¡œ ì „ë‹¬í•´ í˜¸ì¶œí•˜ë©´ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë¨.
            // ë¦¬í„´íƒ€ì… : ResultSet ê°ì²´ - ì¿¼ë¦¬ ê²°ê³¼ì˜ ë ˆì½”ë“œë“¤ì´ ë‹´ê²¨ ìˆë‹¤.
            // DBì˜ ë ˆì½”ë“œë“¤ì€ ResultSet ê°ì²´ì— ì¶”ê°€ëœë‹¤.
            resultSet = statement.executeQuery(sql);

            // 6. ì‹¤í–‰ ê²°ê³¼ ì¶œë ¥
            // (ì¼ë°˜ì ìœ¼ë¡œ ê²°ê³¼ ì¡°íšŒë¥¼ ìœ„í•´ì„œëŠ” VOê°ì²´ë¥¼ ì‚¬ìš©í•¨(í‚¤ì›Œë“œ - DAO, VO)
            while (resultSet.next()) {
                // ì£¼ì˜ - DB ë ˆì½”ë“œë“¤ì˜ ì¹¼ëŸ¼ì€ 0ì´ ì•„ë‹Œ 1ë¶€í„° ì‹œì‘í•œë‹¤.
                // resultSet.next()ëŠ” booleanì„ ë¦¬í„´í•¨ - ë‹¤ìŒ ë ˆì½”ë“œê°€ ì¡´ì¬í•˜ë©´ true ë¦¬í„´
                
                String nickname = resultSet.getString(1);
                int money = resultSet.getInt(2);
                // DBì—ì„œ ê°€ì ¸ì˜¤ëŠ” ë°ì´í„° íƒ€ì…ì— ë§ê²Œ getString() ë˜ëŠ” getInt() ë“±ì„ í˜¸ì¶œí•œë‹¤.

                System.out.println(nickname + " : " + money);
            }
            // ê²°ê³¼ : MySQLì˜ user ë°ì´í„°ë² ì´ìŠ¤, user_log í…Œì´ë¸”ì—ì„œ nickname(String)ê³¼ money(int)ë¥¼ ê°€ì ¸ì™€ ì¶œë ¥í•¨.
        } catch (ClassNotFoundException e) {
            System.out.println("ë“œë¼ì´ë²„ ë¡œë”© ì‹¤íŒ¨");
        } catch (SQLException e) {
            System.out.println("ì—ëŸ¬ " + e);
        }
        finally {
            // Connection, Statement, ResultSet ê°ì²´ë¥¼ ë‹«ëŠ” ì½”ë“œ.
            // isClosed(), close()ëŠ” SQLException ë°œìƒ ê°€ëŠ¥ - try-catchë¡œ ì˜ˆì™¸ì²˜ë¦¬.
            try {
                if (connection != null && !connection.isClosed()) {
                    // Connectionì´ ì¡´ì¬í•˜ê³ , ë‹«í˜€ìˆì§€ ì•Šë‹¤ë©´
                    connection.close();
                }
                if (statement != null && !statement.isClosed()) {
                    statement.close();
                }
                if (resultSet != null && !resultSet.isClosed()) {
                    resultSet.close();
                }
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
    }
}

```





### INSERTë¬¸ ì˜ˆì œ

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class InsertMySQL {
    public static void main(String[] args) {
        insert(13 ,"robbins", 3100, "2021-01-31 00:00:00");
    }

    public static void insert(int id, String nickname, int money, String last_visit) {
        Connection connection = null;
        PreparedStatement preparedStatement = null;

        try {
            // 1. connector(ë“œë¼ì´ë²„) ë¡œë”©.
            // ClassNotFoundException ë°œìƒ ê°€ëŠ¥ - ì˜ˆì™¸ì²˜ë¦¬ í•„ìš”.
            Class.forName("com.mysql.jdbc.Driver");

            // 2. DBì™€ ì—°ê²°í•˜ê¸° -  connection = DriverManager.getConnection()
            // SQLException ë°œìƒ ê°€ëŠ¥ - ì˜ˆì™¸ì²˜ë¦¬ í•„ìš”.
            String url = "jdbc:mysql://localhost/DBëª…";
            connection = DriverManager.getConnection(url, "DBì‚¬ìš©ìID", "DBì‚¬ìš©ìPW");

            // 3. ì¿¼ë¦¬ ìˆ˜í–‰ì„ ìœ„í•œ PreparedStatement ê°ì²´ ìƒì„±
            // INSERTë¡œ ì¶”ê°€í•˜ëŠ” ë°ì´í„° ê°’ì€ ë³´í†µ íŒŒë¼ë¯¸í„°ë¥¼ í†µí•´ ë™ì  í• ë‹¹ë˜ëŠ” ê°’ì´ë¯€ë¡œ,
            // Statement.createStatement()ê°€ ì•„ë‹Œ PreparedStatement.prepareStatement()ë¥¼ ì‚¬ìš©í•¨.
            // (ì¿¼ë¦¬ë¥¼ ì¤€ë¹„í•˜ëŠ” statementë¼ëŠ” ì˜ë¯¸)
            // prepareStatement()ëŠ” PreparedStatement ê°ì²´ë¥¼ ë°˜í™˜í•˜ë©°,
            // ì´ ê°ì²´ì—ëŠ” PreparedStatement.setString()ìœ¼ë¡œ ë™ì ìœ¼ë¡œ ê°’ì„ í• ë‹¹í•  ìˆ˜ ìˆìŒ.
            // PreparedStatement ë©”ì†Œë“œë“¤ì€ SQLException ë°œìƒ ê°€ëŠ¥ - ì˜ˆì™¸ì²˜ë¦¬ í•„ìš”.
            String sql = "INSERT INTO user_log VALUES (?,?,?,?)";
            preparedStatement = connection.prepareStatement(sql);
            
            // 4. ë°ì´í„° binding - sqlë¬¸ì˜ ê° ìš”ì†Œì— íŒŒë¼ë¯¸í„° ê°’ì„ í• ë‹¹í•´ì¤Œ
            preparedStatement.setInt(1, id);
            preparedStatement.setString(2, nickname);
            preparedStatement.setInt(3, money);
            preparedStatement.setString(4, last_visit);

            // 5. ì¿¼ë¦¬ ì‹¤í–‰ ë° ê²°ê³¼ ì²˜ë¦¬
            // SELECTì™€ ë‹¬ë¦¬ INSERTëŠ” ë°˜í™˜ ë°ì´í„°ê°€ ì—†ìœ¼ë¯€ë¡œ ResultSet ê°ì²´ê°€ í•„ìš” ì—†ìŒ.
            // ë”°ë¼ì„œ ë°”ë¡œ PreparedStatement.executeUpdate()ë©”ì„œë“œë¥¼ í˜¸ì¶œí•¨.
            // INSERT, UPDATE, DELETE ì¿¼ë¦¬ : PreparedStatement.executeUpdate()ë¥¼ ì‚¬ìš©í•˜ë©°,
            //   (ì¿¼ë¦¬ì˜ ê²°ê³¼, ì¦‰ ë¦¬í„´ê°’ì´ ì—†ëŠ” ê²½ìš°)
            // SELECT ì¿¼ë¦¬ : Statement.executeQuery()ë¥¼ ì‚¬ìš©í•¨.
            //   (ì¿¼ë¦¬ì˜ ê²°ê³¼, ì¦‰ ë¦¬í„´ê°’ì´ ìˆëŠ” ê²½ìš°)
            // ë¦¬í„´íƒ€ì… : int (ëª‡ ê°œì˜ rowì— ì˜í–¥ì„ ë¯¸ì³¤ëŠ”ì§€ë¥¼ ë°˜í™˜í•¨)
            int count = preparedStatement.executeUpdate();
            if (count == 0) {
                System.out.println("ë°ì´í„° ì…ë ¥ ì‹¤íŒ¨");
            } else {
                System.out.println("ë°ì´í„° ì…ë ¥ ì„±ê³µ");
            }
        } catch (ClassNotFoundException e) {
            System.out.println("ë“œë¼ì´ë²„ ë¡œë”© ì‹¤íŒ¨");
        } catch (SQLException e) {
            System.out.println("ì—ëŸ¬ " + e);
        }
        finally {
            // Connection, PreparedStatement ê°ì²´ë¥¼ ë‹«ëŠ” ì½”ë“œ.
            // isClosed(), close()ëŠ” SQLException ë°œìƒ ê°€ëŠ¥ - try-catchë¡œ ì˜ˆì™¸ì²˜ë¦¬.
            try {
                if (connection != null && !connection.isClosed()) {
                    // Connectionì´ ì¡´ì¬í•˜ê³ , ë‹«í˜€ìˆì§€ ì•Šë‹¤ë©´
                    connection.close();
                }
                if (preparedStatement != null && !preparedStatement.isClosed()) {
                    preparedStatement.close();
                }
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
    }
}

```



---



### [java.sql.SQLException: Column count doesn't match value count at row ìˆ«ì](https://needneo.tistory.com/5)

ìœ„ì˜ INSERTë¬¸ ì˜ˆì œë¥¼ í•˜ë‹¤ê°€ ë°œìƒí•œ ì—ëŸ¬.

MySQL í…Œì´ë¸”ì˜ ì»¬ëŸ¼ê³¼ INSERTí•œ ë°ì´í„°ì˜ ìˆ˜ê°€ ë§ì§€ ì•Šì„ ë•Œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ë¼ê³  í•œë‹¤.

í•´ê²° ) MySQLë‚´ì—ì„œ `AUTO-INCREMENT` ë¡œ ì„¤ì •í•œ ì»¬ëŸ¼ì— ëŒ€í•´ì„œë„ INSERT ê°’ì„ ì§€ì •í•´ ì£¼ì–´ì•¼ í–ˆë‹¤.